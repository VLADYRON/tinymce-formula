!function(e){function t(e,t){e.windowManager.open({title:"Formula",width:900,height:610,html:n(e,t),buttons:[{text:"Cancel",onclick:function(){this.parent().parent().close()}},{text:"Insert Formula",subtype:"primary",onclick:function(t){var n=this;window.frames.tinymceFormula&&window.frames.tinymceFormula.getData?window.frames.tinymceFormula.getData(function(t,a,i){t&&e.insertContent('<img class="fm-editor-equation" src="'+t+'" data-mlang="'+a+'" data-equation="'+encodeURIComponent(i)+'"/>'),n.parent().parent().close()}):n.parent().parent().close()}}]})}function n(e,t){var n=e.selection.getNode(),a=e.getParam("language")||"en",i="",o="";"img"==n.nodeName.toLowerCase()&&n.className.indexOf("fm-editor-equation")>-1&&(n.getAttribute("data-mlang")&&(i="&mlang="+n.getAttribute("data-mlang")),n.getAttribute("data-equation")&&(o="&equation="+n.getAttribute("data-equation")));var r='<iframe name="tinymceFormula" id="tinymceFormula" src="'+t+"/index.html?lang="+a+i+o+'" scrolling="no" frameborder="0"></iframe>';return r}e.create("tinymce.plugins.Formula",{init:function(e,n){e.addButton("formula",{image:n+"/img/formula.png",tooltip:"Insert Formula",onclick:t.bind(this,e,n),onPostRender:function(){var t=this;e.on("NodeChange",function(e){t.active(e.element.className.indexOf("fm-editor-equation")>-1&&"img"==e.element.nodeName.toLowerCase())})}})}}),e.PluginManager.requireLangPack("formula","en,es,fr_FR"),e.PluginManager.add("formula",e.plugins.Formula)}(window.tinymce);